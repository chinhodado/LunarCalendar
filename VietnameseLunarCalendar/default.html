<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <title>VietnameseLunarCalendar</title>

    <!-- WinJS references -->
    <link href="//Microsoft.WinJS.1.0/css/ui-dark.css" rel="stylesheet" />
    <script src="//Microsoft.WinJS.1.0/js/base.js"></script>
    <script src="//Microsoft.WinJS.1.0/js/ui.js"></script>

    <!-- VietnameseLunarCalendar references -->
    <link href="/css/default.css" rel="stylesheet" />
    <script src="/js/default.js"></script>


    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Vietnamese Lunar Calendar" />
    <meta name="author" content="Trung" />
    <link rel="shortcut icon" href="../favicon.ico">
    <link rel="stylesheet" type="text/css" href="css/calendar.css" />
    <link rel="stylesheet" type="text/css" href="css/custom_1.css" />
    <script src="js/jquery.min.js"></script>
    <script src="js/jquery.calendario.js"></script>
    <script src="js/data.js"></script>
    <script src="js/amlich-hnd.js"></script>
    <script src="js/script.js"></script>
</head>
<body>
    <div class="container">
        <div class="custom-calendar-wrap custom-calendar-full">
            <div class="custom-header clearfix">
                <h2>Vietnamese Lunar Calendar</h2>
                <h3 class="custom-month-year">
                    <span id="custom-month" class="custom-month"></span>
                    <span id="custom-year" class="custom-year"></span>
                    <nav>
                        <span id="custom-prev" class="custom-prev"></span>
                        <span id="custom-next" class="custom-next"></span>
                        <span id="custom-current" class="custom-current" title="Got to current date"></span>
                    </nav>
                </h3>
            </div>
            <div id="calendar" class="fc-calendar-container"></div>
        </div>
    </div>
    <script type="text/javascript">
        $(function () {
            var cal = $('#calendar').calendario({
                onDayClick: function ($el, $contentEl, dateProperties) {
                    //the solar stuffs
                    var currentSolarDay = parseInt(dateProperties['day']);
                    var currentSolarMonth = parseInt(dateProperties['month']);
                    var currentSolarYear = cal.getYear();
                    //to lunar
                    var lunarDate = getLunarDate(currentSolarDay, currentSolarMonth, currentSolarYear);
                    //get the day info
                    var dayInfo = getDayInfo(lunarDate.day, lunarDate.month, lunarDate.year, lunarDate.leap, lunarDate.jd, currentSolarDay, currentSolarMonth, currentSolarYear);
                    //display dialog
                    var md = new Windows.UI.Popups.MessageDialog(dayInfo);
                    md.showAsync();

                    //for (var key in dateProperties) {
                    //    console.log(key + ' = ' + dateProperties[key]);
                    //}
                },
                caldata: codropsEvents
            }),
                $month = $('#custom-month').html(cal.getMonthName()),
                $year = $('#custom-year').html(cal.getYear());

            $('#custom-next').on('click', function () {
                cal.gotoNextMonth(updateMonthYear);
            });
            $('#custom-prev').on('click', function () {
                cal.gotoPreviousMonth(updateMonthYear);
            });
            $('#custom-current').on('click', function () {
                cal.gotoNow(updateMonthYear);
            });

            function updateMonthYear() {
                $month.html(cal.getMonthName());
                $year.html(cal.getYear());
                displayLunar(cal);
            }
            displayLunar(cal);
            //liveTile(cal);//display the live tile

            //register the background task. Note that I used InternetAvailable here instead of TimeTrigger
            //since TimeTrigger requires user to put the app on the lock screen, which I don't want to
            registerBackgroundTask("js\\bgtask.js",
                                   "UpdateTileBackgroundTask",
                                    new Windows.ApplicationModel.Background.SystemTrigger(Windows.ApplicationModel.Background.SystemTriggerType.internetAvailable, false),
                                    null);
        });
    </script>
</body>
</html>
